<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.realer.dao.expand.u.GabUValueDescExpandMapper">
<resultMap id="BaseResultMap" type="cn.com.realer.pojo.GabUValueDesc" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="police_id" property="policeId" jdbcType="INTEGER" />
    <result column="theme_id" property="themeId" jdbcType="INTEGER" />
    <result column="item_id" property="itemId" jdbcType="INTEGER" />
    <result column="name_" property="name" jdbcType="VARCHAR" />
    <result column="value_" property="value" jdbcType="VARCHAR" />
    <result column="number_" property="number" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="isdelete" property="isdelete" jdbcType="SMALLINT" />
    <result column="block_id" property="blockId" jdbcType="INTEGER" />
    <result column="options_id" property="optionsId" jdbcType="INTEGER" />
  </resultMap>
  
   <sql id="Fields">
    t.id, t.police_id, t.theme_id, t.item_id, t.name_, t.value_, t.number_, t.create_time, t.update_time, 
    t.isdelete, t.block_id, t.options_id
   </sql>
 
  <select id="selectList" resultMap="BaseResultMap" parameterType="map">
        SELECT  <include refid="Fields"></include> from gab_u_value_desc t WHERE (t.isdelete IS NULL OR t.isdelete=0)
        <if test="id!=null">
            and t.id = #{id}
        </if>
        <if test="themeId!=null">
            and t.theme_id = #{themeId}
        </if>
        <if test="itemId!=null">
            and t.item_id = #{itemId}
        </if>
   </select>
   
  <select id="selectPoliceCount" resultType="java.lang.Long" parameterType="map">
        SELECT "sum"(number_)  from gab_u_value_desc t WHERE (t.isdelete IS NULL OR t.isdelete=0)
       <if test="itemId!=null">
            and t.item_id = #{itemId}
        </if>
       <if test="policeId!=null">
            and t.police_id = #{policeId}
        </if>
         <if test="themeId!=null">
            and t.theme_id = #{themeId}
        </if>
      
   </select>
   

  <delete id="deleteByCondition"  parameterType="map">
        DELETE from gab_u_value_desc t WHERE (t.isdelete IS NULL OR t.isdelete=0)
        <if test="id!=null">
            and t.id = #{id}
        </if>
        <if test="policeId!=null">
       		and t.police_id = #{policeId}
        </if>
        <if test="themeId!=null">
       		and t.theme_id = #{themeId}
        </if>
        <if test="blockId!=null">
       		and t.block_id = #{blockId}
        </if>
   </delete>
  
  
<!--   <resultMap id="ProportionMap" type="cn.com.realer.pojo.vo.Proportion" >
    
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
   
    <result column="police_name" property="policeName" jdbcType="VARCHAR" />
    <result column="police_num" property="policeNum" jdbcType="INTEGER" />
    <result column="auxiliary_police_num" property="AuxiliaryPoliceNum" jdbcType="INTEGER" />
    <result column="actual_num" property="actualNum" jdbcType="INTEGER" />
    <result column="province_" property="province" jdbcType="VARCHAR" />
  </resultMap>
   
   <select id="selectProportionByItemId" resultMap="ProportionMap" parameterType="map">
        SELECT
        sum(CASE tt.item_id WHEN 3 THEN tt.number_ ELSE 0 END) police_num,
		sum(CASE tt.item_id WHEN 4 THEN tt.number_ ELSE 0 END) actual_num,
		sum(CASE tt.item_id WHEN 5 THEN tt.number_ ELSE 0 END) auxiliary_police_num,
		tt.province_,max(tt.police_name) police_name 
        from (
        SELECT
		d.item_id,
		d.number_,
		P.name_ as police_name,
		P.province_ 
        FROM
		gab_u_value_desc d,
		gab_u_police P 
		WHERE
		d.police_id = P.ID 
		<if test="themeId!=null">
            and d.theme_id = #{themeId}
        </if>
		AND d.item_id IN (3, 4, 5)  
		) tt group by tt.province_       
   </select> -->
      
   <select id="selectProportionByItemId" resultType="java.util.HashMap" parameterType="map">
        SELECT
        <if test="itemIds!=null and itemIds!='' ">
 		<foreach collection="itemIds" index="index" item="itemId" separator="," >
       		sum(CASE tt.item_id WHEN ${itemId} THEN tt.number_ ELSE 0 END) A${index}
		</foreach>
		</if>
		,tt.province_,max(tt.police_name) police_name 
        from (
        SELECT
		d.item_id,
		d.number_,
		P.name_ as police_name,
		P.province_ 
        FROM
		gab_u_value_desc d,
		gab_u_police P 
		WHERE
		d.police_id = P.ID 
		<if test="themeId!=null">
            and d.theme_id = #{themeId}
        </if>
		<if test="itemIds!=null and itemIds!='' ">
		AND d.item_id IN
 		<foreach collection="itemIds" index="index" item="itemId" open="("  separator="," close=")">
       		 ${itemId}
		</foreach>
		</if> 
		) tt group by tt.province_       
   </select>

  
      <select id="selectPoliceCount1" resultType="java.util.Map" parameterType="map">
			select t.name_ as name_ ,"sum"(t.number_) as number_
			from (select l.name_ , o.number_
					FROM gab_m_location l,(select P."id",p.name_ ,p.province_,u.number_
					from gab_u_police p  left join gab_u_value_desc u
					on p.id = u.police_id
					where 
					 (u.isdelete IS NULL OR u.isdelete=0)
				       <if test="itemId!=null">
				            and u.item_id = #{itemId}
				        </if>
				      
				         <if test="themeId!=null">
				            and u.theme_id = #{themeId}
				        </if>
					) o
			WHERE l."id" = o.province_) t
			GROUP BY t.name_
   </select>
      
      
         <select id="selectJWMSCount" resultType="java.util.Map" >
						
			SELECT
				tt.province_,
				"sum" ( CASE tt.options_id WHEN 1 THEN 1 ELSE 0 END ) twoteam_num,
				"sum" ( CASE tt.options_id WHEN 2 THEN 1 ELSE 0 END ) threeteam_num,
				"sum" ( CASE tt.options_id WHEN 3 THEN 1 ELSE 0 END ) moreteam_num,
				"sum" ( CASE tt.options_id WHEN 4 THEN 1 ELSE 0 END ) other_num 
			FROM
				(
			SELECT
				u.province_,
				u.name_,
				v.item_id,
				v.options_id,
				o.name_ 
			FROM
				gab_u_police u,
				gab_u_value_desc v,
				gab_m_options o 
			WHERE
				v.options_id = o.id 
				AND u.id = v.police_id 
				) tt 
			GROUP BY
				tt.province_
   </select>
      
         <select id="selectAllJWMSCount" resultType="java.util.Map" >
						
				
	select sum(cc.twoteam_num) as twoteam_numcount,
				sum(cc.threeteam_num) as threeteam_numcount,
				sum(cc.moreteam_num) as moreteam_numcount,
				sum(cc.other_num) as other_numcount
	from
			(SELECT
			tt.province_,
			"sum" ( CASE tt.options_id WHEN 1 THEN 1 ELSE 0 END ) twoteam_num,
			"sum" ( CASE tt.options_id WHEN 2 THEN 1 ELSE 0 END ) threeteam_num,
			"sum" ( CASE tt.options_id WHEN 3 THEN 1 ELSE 0 END ) moreteam_num,
			"sum" ( CASE tt.options_id WHEN 4 THEN 1 ELSE 0 END ) other_num 
		FROM
			(
		SELECT
			u.province_,
			u.name_,
			v.item_id,
			v.options_id,
			o.name_ 
		FROM
			gab_u_police u,
			gab_u_value_desc v,
			gab_m_options o 
		WHERE
			v.options_id = o.id 
			AND u.id = v.police_id 
			) tt 
		GROUP BY
			tt.province_
		) cc
   </select>
      
      
      
</mapper>